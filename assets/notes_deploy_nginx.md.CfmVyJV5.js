import{_ as i,c as a,o as n,ae as l}from"./chunks/framework.Dgg8-8ov.js";const c=JSON.parse('{"title":"Nginx","description":"","frontmatter":{},"headers":[],"relativePath":"notes/deploy/nginx.md","filePath":"notes/deploy/nginx.md"}'),e={name:"notes/deploy/nginx.md"};function t(h,s,p,k,r,d){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="nginx" tabindex="-1">Nginx <a class="header-anchor" href="#nginx" aria-label="Permalink to &quot;Nginx&quot;">​</a></h1><h2 id="nginx-学习知识点" tabindex="-1">Nginx 学习知识点 <a class="header-anchor" href="#nginx-学习知识点" aria-label="Permalink to &quot;Nginx 学习知识点&quot;">​</a></h2><ul><li></li></ul><h3 id="配置相关说明" tabindex="-1">配置相关说明 <a class="header-anchor" href="#配置相关说明" aria-label="Permalink to &quot;配置相关说明&quot;">​</a></h3><p>以下为常用 Nginx 配置文件（nginx.conf）说明：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 全局块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">user </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> nginx;                </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定Nginx运行的用户</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_processes </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 工作进程数，通常为CPU核心数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logs/error.log;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 错误日志路径</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pid </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">       logs/nginx.pid;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># PID文件路径</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 事件块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    worker_connections </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 每个进程最大连接数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># http块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      mime.types;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 文件扩展名与类型映射表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    default_type </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> application/octet-stream; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认类型</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    sendfile </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">       on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开启高效文件传输模式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    keepalive_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 65</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 长连接超时时间</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 日志格式</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    access_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> logs/access.log  </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 服务器块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 监听端口</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> localhost;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 服务器名称</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 位置块</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  html;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 站点根目录</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> index.html index.htm; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认首页</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 错误页面</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        error_page </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  500</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 502</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 503</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 504</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  /50x.html;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /50x.html </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  html;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="主要配置块说明" tabindex="-1">主要配置块说明 <a class="header-anchor" href="#主要配置块说明" aria-label="Permalink to &quot;主要配置块说明&quot;">​</a></h4><ul><li><strong>全局块</strong>：影响 Nginx 全局的配置，如用户、进程数、日志等。</li><li><strong>events 块</strong>：影响 Nginx 服务器与用户的网络连接。</li><li><strong>http 块</strong>：主要的 web 服务相关配置，可以包含多个 server。</li><li><strong>server 块</strong>：虚拟主机配置，可以有多个 server。</li><li><strong>location 块</strong>：用于匹配 URI，实现路由和资源定位。</li></ul><h4 id="常用指令说明" tabindex="-1">常用指令说明 <a class="header-anchor" href="#常用指令说明" aria-label="Permalink to &quot;常用指令说明&quot;">​</a></h4><ul><li><code>listen</code>：监听端口</li><li><code>server_name</code>：主机名</li><li><code>root</code>：指定资源根目录</li><li><code>index</code>：默认首页文件</li><li><code>error_page</code>：自定义错误页面</li><li><code>access_log</code>/<code>error_log</code>：访问/错误日志路径</li><li><code>proxy_pass</code>：反向代理转发地址</li></ul><p>如需更详细配置，可参考官方文档或实际业务需求进行调整。</p><h3 id="通过nginx和json直接返回json内容" tabindex="-1">通过nginx和json直接返回json内容 <a class="header-anchor" href="#通过nginx和json直接返回json内容" aria-label="Permalink to &quot;通过nginx和json直接返回json内容&quot;">​</a></h3><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /mobile/apk/version </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        alias </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">D:/files/json/;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try_files </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$uri.json </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">=404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        default_type </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">application/json;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        # 可选：添加CORS头部</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre></div><h3 id="安全设置说明" tabindex="-1">安全设置说明 <a class="header-anchor" href="#安全设置说明" aria-label="Permalink to &quot;安全设置说明&quot;">​</a></h3><ul><li><p><code>add_header Content-Security-Policy ...</code><br> 设置内容安全策略（CSP），用于防止 XSS 攻击和数据注入。</p><ul><li><code>default-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39; ...</code>：默认只允许本域名资源，部分放开内联脚本和 eval（不推荐生产环境使用）。</li><li><code>img-src &#39;self&#39; data:</code>：图片资源仅允许本域名和 data URI。</li><li><code>font-src &#39;self&#39; data:</code>：字体资源仅允许本域名和 data URI。</li><li><code>connect-src ...</code>：限制可发起连接的目标（如 API、WebSocket）。</li><li><code>frame-src &#39;none&#39;</code>：禁止页面被嵌入到 iframe。</li><li><code>object-src &#39;none&#39;</code>：禁止使用 object、embed、applet 等标签。</li><li><code>media-src &#39;self&#39; blob:</code>：媒体资源仅允许本域名和 blob 协议。</li></ul></li><li><p><code>add_header X-XSS-Protection &quot;1; mode=block&quot; always;</code><br> 启用浏览器的 XSS 攻击防护机制，发现攻击时阻止页面加载。</p></li><li><p><code>add_header Referrer-Policy &quot;strict-origin-when-cross-origin&quot; always;</code><br> 控制 Referer 头的发送策略，提升隐私安全，跨域请求时只发送源信息。</p></li><li><p><code>add_header X-Content-Type-Options &quot;nosniff&quot; always;</code><br> 防止浏览器对响应内容类型进行 MIME 类型嗅探，降低内容类型混淆攻击风险。</p></li><li><p><code>add_header X-Frame-Options &quot;SAMEORIGIN&quot; always;</code><br> 只允许本域名页面被嵌入到 iframe，防止点击劫持攻击。</p></li></ul><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Content-Security-Policy </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;default-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;; img-src &#39;self&#39; data:; font-src &#39;self&#39; data:; connect-src &#39;self&#39; http://t0.tianditu.gov.cn http://t1.tianditu.gov.cn http://t2.tianditu.gov.cn http://t3.tianditu.gov.cn http://t4.tianditu.gov.cn http://t5.tianditu.gov.cn http://t6.tianditu.gov.cn http://t7.tianditu.gov.cn; frame-src &#39;none&#39;; object-src &#39;none&#39;; media-src &#39;self&#39; blob:;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-XSS-Protection </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1; mode=block&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Referrer-Policy </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;strict-origin-when-cross-origin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Content-Type-Options </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nosniff&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Frame-Options </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SAMEORIGIN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span></code></pre></div><h3 id="" tabindex="-1"><a class="header-anchor" href="#" aria-label="Permalink to &quot;&quot;">​</a></h3><h2 id="nginx-学习参考资料" tabindex="-1">Nginx 学习参考资料 <a class="header-anchor" href="#nginx-学习参考资料" aria-label="Permalink to &quot;Nginx 学习参考资料&quot;">​</a></h2><ul><li><a href="https://nginx.org/en/docs/" target="_blank" rel="noreferrer">Nginx 官方文档</a> Nginx 服务器官方英文文档，配置与用法。</li></ul>`,20)]))}const g=i(e,[["render",t]]);export{c as __pageData,g as default};
